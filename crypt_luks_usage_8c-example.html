<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cryptsetup API: crypt_luks_usage.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cryptsetup API
   </div>
   <div id="projectbrief">Public cryptsetup API</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">crypt_luks_usage.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> *  libcryptsetup API - using LUKS device example</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Copyright (C) 2011-2021 Red Hat, Inc. All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is free software; you can redistribute it and/or</span></div>
<div class="line"><span class="comment"> * modify it under the terms of the GNU Lesser General Public</span></div>
<div class="line"><span class="comment"> * License as published by the Free Software Foundation; either</span></div>
<div class="line"><span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This file is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div>
<div class="line"><span class="comment"> * Lesser General Public License for more details.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * You should have received a copy of the GNU Lesser General Public</span></div>
<div class="line"><span class="comment"> * License along with this file; if not, write to the Free Software</span></div>
<div class="line"><span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="libcryptsetup_8h.html">libcryptsetup.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> format_and_add_keyslots(<span class="keyword">const</span> <span class="keywordtype">char</span> *path)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">struct </span>crypt_device *cd;</div>
<div class="line">        <span class="keywordtype">int</span> r;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * The crypt_init() call is used  to initialize crypt_device context,</span></div>
<div class="line"><span class="comment">         * The path parameter specifies a device path.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * For path, you can use either link to a file or block device.</span></div>
<div class="line"><span class="comment">         * The loopback device will be detached automatically.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line"> </div>
<div class="line">        r = <a name="a0"></a><a class="code" href="group__crypt-init.html#gacd96672d584b9e62fcfd702c41e4556d">crypt_init</a>(&amp;cd, path);</div>
<div class="line">        <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;crypt_init() failed for %s.\n&quot;</span>, path);</div>
<div class="line">                <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;Context is attached to block device %s.\n&quot;</span>, <a name="a1"></a><a class="code" href="group__crypt-devstat.html#gafe63a9c1eb9b0a07da1ac3ae915cee64">crypt_get_device_name</a>(cd));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * So far, no data were written to the device.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        printf(<span class="stringliteral">&quot;Device %s will be formatted as a LUKS device after 5 seconds.\n&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;Press CTRL+C now if you want to cancel this operation.\n&quot;</span>, path);</div>
<div class="line">        sleep(5);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * NULLs for uuid and volume_key means that these attributes will be</span></div>
<div class="line"><span class="comment">         * generated during crypt_format().</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        r = <a name="a2"></a><a class="code" href="group__crypt-actions.html#ga7ae085869e1bc17d9abde6cb3f588467">crypt_format</a>(cd,            <span class="comment">/* crypt context */</span></div>
<div class="line">                         <a name="a3"></a><a class="code" href="group__crypt-type.html#gac5cb079126796baa0c2f1814c87b94af">CRYPT_LUKS2</a>,   <span class="comment">/* LUKS2 is a new LUKS format; use CRYPT_LUKS1 for LUKS1 */</span></div>
<div class="line">                         <span class="stringliteral">&quot;aes&quot;</span>,         <span class="comment">/* used cipher */</span></div>
<div class="line">                         <span class="stringliteral">&quot;xts-plain64&quot;</span>, <span class="comment">/* used block mode and IV */</span></div>
<div class="line">                         NULL,          <span class="comment">/* generate UUID */</span></div>
<div class="line">                         NULL,          <span class="comment">/* generate volume key from RNG */</span></div>
<div class="line">                         512 / 8,       <span class="comment">/* 512bit key - here AES-256 in XTS mode, size is in bytes */</span></div>
<div class="line">                         NULL);         <span class="comment">/* default parameters */</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;crypt_format() failed on device %s\n&quot;</span>, <a class="code" href="group__crypt-devstat.html#gafe63a9c1eb9b0a07da1ac3ae915cee64">crypt_get_device_name</a>(cd));</div>
<div class="line">                <a name="a4"></a><a class="code" href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a>(cd);</div>
<div class="line">                <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * The device now contains a LUKS header, but there is no active keyslot.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * crypt_keyslot_add_* call stores the volume_key in the encrypted form into the keyslot.</span></div>
<div class="line"><span class="comment">         *</span></div>
<div class="line"><span class="comment">         * After format, the volume key is stored internally.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        r = <a name="a5"></a><a class="code" href="group__crypt-keyslot.html#ga93a404f2f6f6e88ccd82b6b02ccb9a84">crypt_keyslot_add_by_volume_key</a>(cd,                 <span class="comment">/* crypt context */</span></div>
<div class="line">                                            <a name="a6"></a><a class="code" href="group__crypt-keyslot.html#ga2efb82bfa83f67465f1a48b5088b1560">CRYPT_ANY_SLOT</a>,     <span class="comment">/* just use first free slot */</span></div>
<div class="line">                                            NULL,               <span class="comment">/* use internal volume key */</span></div>
<div class="line">                                            0,                  <span class="comment">/* unused (size of volume key) */</span></div>
<div class="line">                                            <span class="stringliteral">&quot;foo&quot;</span>,              <span class="comment">/* passphrase - NULL means query*/</span></div>
<div class="line">                                            3);                 <span class="comment">/* size of passphrase */</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Adding keyslot failed.\n&quot;</span>);</div>
<div class="line">                <a class="code" href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a>(cd);</div>
<div class="line">                <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;The first keyslot is initialized.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Add another keyslot, now authenticating with the first keyslot.</span></div>
<div class="line"><span class="comment">         * It decrypts the volume key from the first keyslot and creates a new one with the specified passphrase.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        r = <a name="a7"></a><a class="code" href="group__crypt-keyslot.html#ga50fd2497a256706db7a37f77b22e1ced">crypt_keyslot_add_by_passphrase</a>(cd,                 <span class="comment">/* crypt context */</span></div>
<div class="line">                                            <a class="code" href="group__crypt-keyslot.html#ga2efb82bfa83f67465f1a48b5088b1560">CRYPT_ANY_SLOT</a>,     <span class="comment">/* just use first free slot */</span></div>
<div class="line">                                            <span class="stringliteral">&quot;foo&quot;</span>, 3,           <span class="comment">/* passphrase for the old keyslot */</span></div>
<div class="line">                                            <span class="stringliteral">&quot;bar&quot;</span>, 3);          <span class="comment">/* passphrase for the new kesylot */</span></div>
<div class="line">        <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Adding keyslot failed.\n&quot;</span>);</div>
<div class="line">                <a class="code" href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a>(cd);</div>
<div class="line">                <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;The second keyslot is initialized.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a>(cd);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> activate_and_check_status(<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keyword">const</span> <span class="keywordtype">char</span> *device_name)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">struct </span>crypt_device *cd;</div>
<div class="line">        <span class="keyword">struct </span><a name="_a8"></a><a class="code" href="structcrypt__active__device.html">crypt_active_device</a> cad;</div>
<div class="line">        <span class="keywordtype">int</span> r;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * LUKS device activation example.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        r = <a class="code" href="group__crypt-init.html#gacd96672d584b9e62fcfd702c41e4556d">crypt_init</a>(&amp;cd, path);</div>
<div class="line">        <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;crypt_init() failed for %s.\n&quot;</span>, path);</div>
<div class="line">                <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * crypt_load() is used to load existing LUKS header from a block device</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        r = <a name="a9"></a><a class="code" href="group__crypt-actions.html#ga7af2ba4a33a3be8b1abc6248292f7b16">crypt_load</a>(cd,              <span class="comment">/* crypt context */</span></div>
<div class="line">                       <a name="a10"></a><a class="code" href="group__crypt-type.html#ga273f511327cce62a872d8861ba32d349">CRYPT_LUKS</a>,      <span class="comment">/* requested type - here LUKS of any type */</span></div>
<div class="line">                       NULL);           <span class="comment">/* additional parameters (not used) */</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;crypt_load() failed on device %s.\n&quot;</span>, <a class="code" href="group__crypt-devstat.html#gafe63a9c1eb9b0a07da1ac3ae915cee64">crypt_get_device_name</a>(cd));</div>
<div class="line">                <a class="code" href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a>(cd);</div>
<div class="line">                <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Device activation creates a device-mapper device with the specified name.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        r = <a name="a11"></a><a class="code" href="group__crypt-activation.html#ga67fd5a62c320553d8cbfe32d0642537d">crypt_activate_by_passphrase</a>(cd,            <span class="comment">/* crypt context */</span></div>
<div class="line">                                         device_name,   <span class="comment">/* device name to activate */</span></div>
<div class="line">                                         <a class="code" href="group__crypt-keyslot.html#ga2efb82bfa83f67465f1a48b5088b1560">CRYPT_ANY_SLOT</a>,<span class="comment">/* the keyslot use (try all here) */</span></div>
<div class="line">                                         <span class="stringliteral">&quot;foo&quot;</span>, 3,      <span class="comment">/* passphrase */</span></div>
<div class="line">                                         <a name="a12"></a><a class="code" href="group__crypt-aflags.html#ga05d49a1387d2f52d9ae354c2c9b66d65">CRYPT_ACTIVATE_READONLY</a>); <span class="comment">/* flags */</span></div>
<div class="line">        <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Device %s activation failed.\n&quot;</span>, device_name);</div>
<div class="line">                <a class="code" href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a>(cd);</div>
<div class="line">                <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;%s device %s/%s is active.\n&quot;</span>, <a name="a13"></a><a class="code" href="group__crypt-type.html#gac2b7258ead1da4ef2595931f73384845">crypt_get_type</a>(cd), <a name="a14"></a><a class="code" href="group__crypt-keyslot.html#ga8e623a674d86295e683c804f5aaceb4d">crypt_get_dir</a>(), device_name);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\tcipher used: %s\n&quot;</span>, <a name="a15"></a><a class="code" href="group__crypt-devstat.html#gaf10aab5cb08fb94e1751d0811067d6d3">crypt_get_cipher</a>(cd));</div>
<div class="line">        printf(<span class="stringliteral">&quot;\tcipher mode: %s\n&quot;</span>, <a name="a16"></a><a class="code" href="group__crypt-devstat.html#gaf8c0dfe445480a70b9d99e4db0bf91f8">crypt_get_cipher_mode</a>(cd));</div>
<div class="line">        printf(<span class="stringliteral">&quot;\tdevice UUID: %s\n&quot;</span>, <a name="a17"></a><a class="code" href="group__crypt-devstat.html#ga1aeec67529d8076c1de99e6fc9c2620b">crypt_get_uuid</a>(cd));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Get info about the active device.</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        r = <a name="a18"></a><a class="code" href="group__crypt-aflags.html#ga1f249614538612c7b8948bf20a5f63e3">crypt_get_active_device</a>(cd, device_name, &amp;cad);</div>
<div class="line">        <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Get info about active device %s failed.\n&quot;</span>, device_name);</div>
<div class="line">                <a name="a19"></a><a class="code" href="group__crypt-activation.html#ga8062cdc2cd254f2bb69358cd1c80a2c6">crypt_deactivate</a>(cd, device_name);</div>
<div class="line">                <a class="code" href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a>(cd);</div>
<div class="line">                <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;Active device parameters for %s:\n&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;\tDevice offset (in sectors): %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;\tIV offset (in sectors)    : %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;\tdevice size (in sectors)  : %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;\tread-only flag            : %s\n&quot;</span>,</div>
<div class="line">                device_name, cad.offset, cad.iv_offset, cad.size,</div>
<div class="line">                cad.flags &amp; <a class="code" href="group__crypt-aflags.html#ga05d49a1387d2f52d9ae354c2c9b66d65">CRYPT_ACTIVATE_READONLY</a> ? <span class="stringliteral">&quot;1&quot;</span> : <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a>(cd);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> handle_active_device(<span class="keyword">const</span> <span class="keywordtype">char</span> *device_name)</div>
<div class="line">{</div>
<div class="line">        <span class="keyword">struct </span>crypt_device *cd;</div>
<div class="line">        <span class="keywordtype">int</span> r;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * crypt_init_by_name() initializes context by an active device-mapper name</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        r = <a name="a20"></a><a class="code" href="group__crypt-init.html#ga2a93cfb11dc3a35a49f3d142da482959">crypt_init_by_name</a>(&amp;cd, device_name);</div>
<div class="line">        <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;crypt_init_by_name() failed for %s.\n&quot;</span>, device_name);</div>
<div class="line">                <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a21"></a><a class="code" href="group__crypt-devstat.html#gab63bcdc11155d762c74ac5e6d609c891">crypt_status</a>(cd, device_name) == <a name="a22"></a><a class="code" href="group__crypt-devstat.html#gga94309106213ec66fb196a32d73eefb5ba797d83ec2eca7a5e7f10ccc69ee35f9b">CRYPT_ACTIVE</a>)</div>
<div class="line">                printf(<span class="stringliteral">&quot;Device %s is still active.\n&quot;</span>, device_name);</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Something failed perhaps, device %s is not active.\n&quot;</span>, device_name);</div>
<div class="line">                <a class="code" href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a>(cd);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * crypt_deactivate() is used to deactivate a device</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        r = <a class="code" href="group__crypt-activation.html#ga8062cdc2cd254f2bb69358cd1c80a2c6">crypt_deactivate</a>(cd, device_name);</div>
<div class="line">        <span class="keywordflow">if</span> (r &lt; 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;crypt_deactivate() failed.\n&quot;</span>);</div>
<div class="line">                <a class="code" href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a>(cd);</div>
<div class="line">                <span class="keywordflow">return</span> r;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        printf(<span class="stringliteral">&quot;Device %s is now deactivated.\n&quot;</span>, device_name);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a>(cd);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (geteuid()) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Using of libcryptsetup requires super user privileges.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> 1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (argc != 2) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;usage: ./crypt_luks_usage &lt;path&gt;\n&quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;&lt;path&gt; refers to either a regular file or a block device.\n&quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;       WARNING: the file or device will be wiped.\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">return</span> 2;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (format_and_add_keyslots(argv[1]))</div>
<div class="line">                <span class="keywordflow">return</span> 3;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (activate_and_check_status(argv[1], <span class="stringliteral">&quot;example_device&quot;</span>))</div>
<div class="line">                <span class="keywordflow">return</span> 4;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (handle_active_device(<span class="stringliteral">&quot;example_device&quot;</span>))</div>
<div class="line">                <span class="keywordflow">return</span> 5;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__crypt-actions_html_ga7ae085869e1bc17d9abde6cb3f588467"><div class="ttname"><a href="group__crypt-actions.html#ga7ae085869e1bc17d9abde6cb3f588467">crypt_format</a></div><div class="ttdeci">int crypt_format(struct crypt_device *cd, const char *type, const char *cipher, const char *cipher_mode, const char *uuid, const char *volume_key, size_t volume_key_size, void *params)</div></div>
<div class="ttc" id="agroup__crypt-actions_html_ga7af2ba4a33a3be8b1abc6248292f7b16"><div class="ttname"><a href="group__crypt-actions.html#ga7af2ba4a33a3be8b1abc6248292f7b16">crypt_load</a></div><div class="ttdeci">int crypt_load(struct crypt_device *cd, const char *requested_type, void *params)</div></div>
<div class="ttc" id="agroup__crypt-activation_html_ga67fd5a62c320553d8cbfe32d0642537d"><div class="ttname"><a href="group__crypt-activation.html#ga67fd5a62c320553d8cbfe32d0642537d">crypt_activate_by_passphrase</a></div><div class="ttdeci">int crypt_activate_by_passphrase(struct crypt_device *cd, const char *name, int keyslot, const char *passphrase, size_t passphrase_size, uint32_t flags)</div></div>
<div class="ttc" id="agroup__crypt-activation_html_ga8062cdc2cd254f2bb69358cd1c80a2c6"><div class="ttname"><a href="group__crypt-activation.html#ga8062cdc2cd254f2bb69358cd1c80a2c6">crypt_deactivate</a></div><div class="ttdeci">int crypt_deactivate(struct crypt_device *cd, const char *name)</div></div>
<div class="ttc" id="agroup__crypt-aflags_html_ga05d49a1387d2f52d9ae354c2c9b66d65"><div class="ttname"><a href="group__crypt-aflags.html#ga05d49a1387d2f52d9ae354c2c9b66d65">CRYPT_ACTIVATE_READONLY</a></div><div class="ttdeci">#define CRYPT_ACTIVATE_READONLY</div><div class="ttdef"><b>Definition:</b> libcryptsetup.h:1076</div></div>
<div class="ttc" id="agroup__crypt-aflags_html_ga1f249614538612c7b8948bf20a5f63e3"><div class="ttname"><a href="group__crypt-aflags.html#ga1f249614538612c7b8948bf20a5f63e3">crypt_get_active_device</a></div><div class="ttdeci">int crypt_get_active_device(struct crypt_device *cd, const char *name, struct crypt_active_device *cad)</div></div>
<div class="ttc" id="agroup__crypt-devstat_html_ga1aeec67529d8076c1de99e6fc9c2620b"><div class="ttname"><a href="group__crypt-devstat.html#ga1aeec67529d8076c1de99e6fc9c2620b">crypt_get_uuid</a></div><div class="ttdeci">const char * crypt_get_uuid(struct crypt_device *cd)</div></div>
<div class="ttc" id="agroup__crypt-devstat_html_gab63bcdc11155d762c74ac5e6d609c891"><div class="ttname"><a href="group__crypt-devstat.html#gab63bcdc11155d762c74ac5e6d609c891">crypt_status</a></div><div class="ttdeci">crypt_status_info crypt_status(struct crypt_device *cd, const char *name)</div></div>
<div class="ttc" id="agroup__crypt-devstat_html_gaf10aab5cb08fb94e1751d0811067d6d3"><div class="ttname"><a href="group__crypt-devstat.html#gaf10aab5cb08fb94e1751d0811067d6d3">crypt_get_cipher</a></div><div class="ttdeci">const char * crypt_get_cipher(struct crypt_device *cd)</div></div>
<div class="ttc" id="agroup__crypt-devstat_html_gaf8c0dfe445480a70b9d99e4db0bf91f8"><div class="ttname"><a href="group__crypt-devstat.html#gaf8c0dfe445480a70b9d99e4db0bf91f8">crypt_get_cipher_mode</a></div><div class="ttdeci">const char * crypt_get_cipher_mode(struct crypt_device *cd)</div></div>
<div class="ttc" id="agroup__crypt-devstat_html_gafe63a9c1eb9b0a07da1ac3ae915cee64"><div class="ttname"><a href="group__crypt-devstat.html#gafe63a9c1eb9b0a07da1ac3ae915cee64">crypt_get_device_name</a></div><div class="ttdeci">const char * crypt_get_device_name(struct crypt_device *cd)</div></div>
<div class="ttc" id="agroup__crypt-devstat_html_gga94309106213ec66fb196a32d73eefb5ba797d83ec2eca7a5e7f10ccc69ee35f9b"><div class="ttname"><a href="group__crypt-devstat.html#gga94309106213ec66fb196a32d73eefb5ba797d83ec2eca7a5e7f10ccc69ee35f9b">CRYPT_ACTIVE</a></div><div class="ttdeci">@ CRYPT_ACTIVE</div><div class="ttdef"><b>Definition:</b> libcryptsetup.h:1452</div></div>
<div class="ttc" id="agroup__crypt-init_html_ga2a93cfb11dc3a35a49f3d142da482959"><div class="ttname"><a href="group__crypt-init.html#ga2a93cfb11dc3a35a49f3d142da482959">crypt_init_by_name</a></div><div class="ttdeci">int crypt_init_by_name(struct crypt_device **cd, const char *name)</div></div>
<div class="ttc" id="agroup__crypt-init_html_ga69894b2d69adaf9637a17ccab112c9f5"><div class="ttname"><a href="group__crypt-init.html#ga69894b2d69adaf9637a17ccab112c9f5">crypt_free</a></div><div class="ttdeci">void crypt_free(struct crypt_device *cd)</div></div>
<div class="ttc" id="agroup__crypt-init_html_gacd96672d584b9e62fcfd702c41e4556d"><div class="ttname"><a href="group__crypt-init.html#gacd96672d584b9e62fcfd702c41e4556d">crypt_init</a></div><div class="ttdeci">int crypt_init(struct crypt_device **cd, const char *device)</div></div>
<div class="ttc" id="agroup__crypt-keyslot_html_ga2efb82bfa83f67465f1a48b5088b1560"><div class="ttname"><a href="group__crypt-keyslot.html#ga2efb82bfa83f67465f1a48b5088b1560">CRYPT_ANY_SLOT</a></div><div class="ttdeci">#define CRYPT_ANY_SLOT</div><div class="ttdef"><b>Definition:</b> libcryptsetup.h:893</div></div>
<div class="ttc" id="agroup__crypt-keyslot_html_ga50fd2497a256706db7a37f77b22e1ced"><div class="ttname"><a href="group__crypt-keyslot.html#ga50fd2497a256706db7a37f77b22e1ced">crypt_keyslot_add_by_passphrase</a></div><div class="ttdeci">int crypt_keyslot_add_by_passphrase(struct crypt_device *cd, int keyslot, const char *passphrase, size_t passphrase_size, const char *new_passphrase, size_t new_passphrase_size)</div></div>
<div class="ttc" id="agroup__crypt-keyslot_html_ga8e623a674d86295e683c804f5aaceb4d"><div class="ttname"><a href="group__crypt-keyslot.html#ga8e623a674d86295e683c804f5aaceb4d">crypt_get_dir</a></div><div class="ttdeci">const char * crypt_get_dir(void)</div></div>
<div class="ttc" id="agroup__crypt-keyslot_html_ga93a404f2f6f6e88ccd82b6b02ccb9a84"><div class="ttname"><a href="group__crypt-keyslot.html#ga93a404f2f6f6e88ccd82b6b02ccb9a84">crypt_keyslot_add_by_volume_key</a></div><div class="ttdeci">int crypt_keyslot_add_by_volume_key(struct crypt_device *cd, int keyslot, const char *volume_key, size_t volume_key_size, const char *passphrase, size_t passphrase_size)</div></div>
<div class="ttc" id="agroup__crypt-type_html_ga273f511327cce62a872d8861ba32d349"><div class="ttname"><a href="group__crypt-type.html#ga273f511327cce62a872d8861ba32d349">CRYPT_LUKS</a></div><div class="ttdeci">#define CRYPT_LUKS</div><div class="ttdef"><b>Definition:</b> libcryptsetup.h:432</div></div>
<div class="ttc" id="agroup__crypt-type_html_gac2b7258ead1da4ef2595931f73384845"><div class="ttname"><a href="group__crypt-type.html#gac2b7258ead1da4ef2595931f73384845">crypt_get_type</a></div><div class="ttdeci">const char * crypt_get_type(struct crypt_device *cd)</div></div>
<div class="ttc" id="agroup__crypt-type_html_gac5cb079126796baa0c2f1814c87b94af"><div class="ttname"><a href="group__crypt-type.html#gac5cb079126796baa0c2f1814c87b94af">CRYPT_LUKS2</a></div><div class="ttdeci">#define CRYPT_LUKS2</div><div class="ttdef"><b>Definition:</b> libcryptsetup.h:419</div></div>
<div class="ttc" id="alibcryptsetup_8h_html"><div class="ttname"><a href="libcryptsetup_8h.html">libcryptsetup.h</a></div><div class="ttdoc">Public cryptsetup API.</div></div>
<div class="ttc" id="astructcrypt__active__device_html"><div class="ttname"><a href="structcrypt__active__device.html">crypt_active_device</a></div><div class="ttdef"><b>Definition:</b> libcryptsetup.h:1133</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 24 2022 15:30:42 for cryptsetup API by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
